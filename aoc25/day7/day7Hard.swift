import Foundation

class Day7Hard {
    func solve() {
        let grid = input
            .split(separator: "\n")
            .map { Array($0) }
        
        let height = grid.count
        let width = grid[0].count
        
        var startX = 0
        let startY = 0
        for x in 0..<width {
            if grid[0][x] == "S" {
                startX = x
                break
            }
        }
        
        var memo = Array(
            repeating: Array(repeating: -1, count: width),
            count: height
        )
        
        func timelines(x: Int, y: Int) -> Int {
            if y + 1 >= height {
                return 1
            }
            
            if memo[y][x] != -1 {
                return memo[y][x]
            }
            
            let below = grid[y + 1][x]
            var result = 0
            if below == "." {
                result = timelines(x: x, y: y + 1)
            } else if below == "^" {
                var total = 0
                if x > 0 {
                    total += timelines(x: x - 1, y: y + 1)
                }
                if x + 1 < width {
                    total += timelines(x: x + 1, y: y + 1)
                }
                result = total
            }
            
            memo[y][x] = result
            return result
        }
        
        let answer = timelines(x: startX, y: startY)
        print(answer)
    }
    
    let easyInput: String = """
    .......S.......
    ...............
    .......^.......
    ...............
    ......^.^......
    ...............
    .....^.^.^.....
    ...............
    ....^.^...^....
    ...............
    ...^.^...^.^...
    ...............
    ..^...^.....^..
    ...............
    .^.^.^.^.^...^.
    ...............
    """
    
    let input: String = """
    ......................................................................S......................................................................
    .............................................................................................................................................
    ......................................................................^......................................................................
    .............................................................................................................................................
    .....................................................................^.^.....................................................................
    .............................................................................................................................................
    ....................................................................^...^....................................................................
    .............................................................................................................................................
    ...................................................................^.^.^.^...................................................................
    .............................................................................................................................................
    ..................................................................^.^...^.^..................................................................
    .............................................................................................................................................
    .................................................................^.^...^...^.................................................................
    .............................................................................................................................................
    ................................................................^.^...^.^...^................................................................
    .............................................................................................................................................
    ...............................................................^...^.^.^.^...^...............................................................
    .............................................................................................................................................
    ..............................................................^.^.....^.....^.^..............................................................
    .............................................................................................................................................
    .............................................................^.....^...^.^...^.^.............................................................
    .............................................................................................................................................
    ............................................................^.^.^.^.^.^.......^.^............................................................
    .............................................................................................................................................
    ...........................................................^...^.....^.......^.^.^...........................................................
    .............................................................................................................................................
    ..........................................................^.^...^...^...^...^.^.^.^..........................................................
    .............................................................................................................................................
    .........................................................^.^...^.^.^.^...^.......^.^.........................................................
    .............................................................................................................................................
    ........................................................^.^.^.^.^.^.....^...^.^.^...^........................................................
    .............................................................................................................................................
    .......................................................^.^.^.^...^...^.^.......^.^.^.^.......................................................
    .............................................................................................................................................
    ......................................................^.....^...^.^...^.^...^...^.^...^......................................................
    .............................................................................................................................................
    .....................................................^.^.^.............^.^.^.^.^.^.....^.....................................................
    .............................................................................................................................................
    ....................................................^.^.^.^.^.^.^.^...^.......^.^.^.^...^....................................................
    .............................................................................................................................................
    ...................................................^.^.^.^.^...^.^.^...^...^.....^.^.^...^...................................................
    .............................................................................................................................................
    ..................................................^.^.^.....^.........^.^.^.^...^.....^.^.^..................................................
    .............................................................................................................................................
    .................................................^...^.....^.......^.^.^.^...^.^.^.^.^.^.^.^.................................................
    .............................................................................................................................................
    ................................................^.^.^...^.......^.^.^.^.......^...^.^.^.^...^................................................
    .............................................................................................................................................
    ...............................................^.^.^...........^.^.^.^.^...^.^.....^...^.....^...............................................
    .............................................................................................................................................
    ..............................................^.^.....^.^.^.^...^.^...^.^.^.^.^.^.^.^.......^.^..............................................
    .............................................................................................................................................
    .............................................^.^.....^.^.^...^.^...^.^...^.^.....^.^...^.^...^.^.............................................
    .............................................................................................................................................
    ............................................^.^.....^.^.^.^.^...^.^.^.^.^.^.....^...^.^...^...^.^............................................
    .............................................................................................................................................
    ...........................................^.^.^.^...^.^.....^...^...^.^.^.^.^.^.........^...^.^.^...........................................
    .............................................................................................................................................
    ..........................................^.^...^.^.^...^.^.^.^...^.^...^.^.^...^...^...^.^.^.^.^.^..........................................
    .............................................................................................................................................
    .........................................^.^.^.^...^.^...^.^.^.....^.^.....^.^.^...^.....^.^.^...^.^.........................................
    .............................................................................................................................................
    ........................................^.^.....^.^.^...^...^.^.^...^.^.^.^.^...^.^.^.^.....^.^.^.^.^........................................
    .............................................................................................................................................
    .......................................^...^.^.........^.^.....^.^.^...^...^.^.^.^.^...^.^.^.^.^.^.^.^.......................................
    .............................................................................................................................................
    ......................................^.^...^.^...^.....^...^.^.^.^.....^.^.^...^.^.^.^.^.....^.^.....^......................................
    .............................................................................................................................................
    .....................................^.^.^...^.^.^.^.^...^.^.^...^...^.^.^...^.^.^.^...^...^.^.^...^...^.....................................
    .............................................................................................................................................
    ....................................^.^.^...^.^.............^...^.^.^...^...^.^...^.^.^...^.^.^...^.^.^.^....................................
    .............................................................................................................................................
    ...................................^.^.^...^...^.....^.......^.....^.^.^.^...^...^.^...^.^.^.^.^.....^...^...................................
    .............................................................................................................................................
    ..................................^.^...^...^.^.^...^...^.^.....^.^.^...^.........^.....^...^.^.^.^...^...^..................................
    .............................................................................................................................................
    .................................^.^.^.......^.^.^.......^.^...^.^.^...^...^.^.....^.^.^.^.^.^...^.^.^.^.^.^.................................
    .............................................................................................................................................
    ................................^.^.^...^.^.......^...^.^.^.....^.^.^.^.....^.^.^.^...^.^.^...^.^.^...^...^.^................................
    .............................................................................................................................................
    ...............................^.^...^.......^.^.^.^.^.^.^.^.......^.^.^.............^.^.^...^.^.^.^...^...^.^...............................
    .............................................................................................................................................
    ..............................^.^.^...^.^.^...^.^.....^.....^.^.^.^.^.^.^.....^.^.^...^.^...^...^.^.^.^.^.^.^.^..............................
    .............................................................................................................................................
    .............................^.^.^.^.^.^.^...^.^.^.^...^.^.^.^...^.^.^.^.^.........^...^.......^.^...^.^.^.^.^.^.............................
    .............................................................................................................................................
    ............................^...^.^.....^.^.^.........^.^.^.....^.^...^.^.^.....^.^.^.^...^.^.^.^.^.^.^.........^............................
    .............................................................................................................................................
    ...........................^...^...^.......^...^.^.....^...^.^.^.^...^.^...^.^.^.^...^...^.^.........^...^...^...^...........................
    .............................................................................................................................................
    ..........................^.^.^.^.^.....^.^.^.^.....^.....^...^.^...^...^.^.^.^...^.^.......^.^.^.^...^...^.^.^.^.^..........................
    .............................................................................................................................................
    .........................^.^.^.^...^.^.^.......^.^.....^.^...^...^.^.^.^...^...^...^...^.....^.^.^.^...^.^.^...^.^.^.........................
    .............................................................................................................................................
    ........................^.^...^.^.....^.^.^...........^.^.^...^.^...^.......^.......^...^.^.^.^...^.^.^.^.^.^.^.^.^.^........................
    .............................................................................................................................................
    .......................^...........^...^.^.........^.^.^.........^...^.....^.^...^.^.^.^.^.^...^.^.^.^...^...^.^.....^.......................
    .............................................................................................................................................
    ......................^.^.^...^.^...^...^.^.........^...^.^.^.^.^...^.^.^.^.^...^.^.^.........^.^...^.^.^.^.....^.^...^......................
    .............................................................................................................................................
    .....................^...^.^.^.^.^.^...^.^...^.....^...^.^...^.^...^.....^.^.^.^.^.^.^.....^.^.^...^.^...^.^.^.^...^.^.^.....................
    .............................................................................................................................................
    ....................^.^...^...^.^...^.^.^.....^...^.^.^...^.^.^.^.^.....^.^.^...^.....^.^.^...^.^.^.^.^.^.^.^.^.^.......^....................
    .............................................................................................................................................
    ...................^.^...^.^.^...^.^...^.^.^.^...^.^.^.....^.^.^...^.^.......^.^...^.^...^.^...^.^...^...^.....^.....^.^.^...................
    .............................................................................................................................................
    ..................^.^.^.^...^...^...^.^...^.^...^.^.^.....^...^.^...^.^.^.^.^.^.^.^.^.^.^.^...^.....^.^.^.^.^.^.^...^.^.^.^..................
    .............................................................................................................................................
    .................^.^.^.^.^.^.^...^.^.^.^.............^.^...^...^.^...^.........^.....^.^...^.....^.^...^.....^...^...^.^.^.^.................
    .............................................................................................................................................
    ................^...^.^.^.^.^.^.^...^...^.^.^.^.^...^.^.^.^...^.......^.^.^.^.^.....^.^.^.^.^.^...^.....^...^.^...^.^.^.^...^................
    .............................................................................................................................................
    ...............^.^.^.^.^...^.^.^.^.^...^.......^.^.^...^.^...^.^.......^.^.....^.^.^...^...^.^...^.....^.^...^.^.^.^.^.^.^.^.^...............
    .............................................................................................................................................
    ..............^.^.^.^.^.....^.^.......^.^.^.^...^.^...^...^.^.^.^.^.^.^.....^.^.^.^.^.^.......^.^.^.^.^...^.^...^.....^...^.^.^..............
    .............................................................................................................................................
    .............^.^.^.....^.^.^.^...^...^.^.......^.^...^.^.......^.^.....^.^...^.^.^.^.^.^.....^.^.^.^.......^.^.^.^.....^.^.^.^.^.............
    .............................................................................................................................................
    ............^.^...^.^.....^.^.^.^...^.^.^.^.....^.^.^.^.......^...^.^...^.^.^.^...^.^.^.^.^.^.^...^.^.^...^.^...^.^.^.^.^.....^.^............
    .............................................................................................................................................
    ...........^.^.^.^.^.^...^.^.....^...^.^.^.^.^...^...^.^.^.^.^.^.^.....^.^.^.......^.^.^.^.^...^.^.^.^.....^.^.^.^.^.^.....^.^.^.^...........
    .............................................................................................................................................
    ..........^...^.^.^...^.^.^.^.^.^.^.^.^.....^.^...^.^.^.^...^.^.^...^.............^.^.......^.^.^.^...^...^.^.^...^.^...^.^.......^..........
    .............................................................................................................................................
    .........^.^.^.^.^.^.^...^.^.^...^...^...^.^.^.^.....^...^.^...^.^.....^.^.^.^.^.^.^.^...^...^.^.^.^.^.^.^...^.^.^.^...^.....^.....^.........
    .............................................................................................................................................
    ........^.^.^...^.....^.^...^...^.....^.....^.^.^...^.^.^...^...^...^.^...^.^...^...^.....^.^.^.^...^.......^...^.....^.^.^...^.^...^........
    .............................................................................................................................................
    .......^.......^...^.....^.^...^.^.^.^.^.^.^.............^.^.^...^...^.^.^.^.^.^.^.......^.....^.^.^.^.^.^.^.....^.^.^.^.^.^.^...^...^.......
    .............................................................................................................................................
    ......^.^.^.^.^.^...^.^.^.^...^...^.^.^.^.^.......^.....^.^...^...^.^.....^...^.^.^.^...^.^.^...^.^.^.^.^.....^.....^.......^.......^.^......
    .............................................................................................................................................
    .....^...^.^.^.^.^...^.....^.^.....^.^.......^.^.^...^.^.^.^...^.^.^...^.^.^...^.^.^...^.^.^.............^.....^.^.^.^.^.^.......^.^.^.^.....
    .............................................................................................................................................
    ....^.......^.^...^.^...^...^.^.^.^.^.^.^...^.^.^.^...^.^.....^.^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.^.......^...........^.....^...^.^.^.^.^....
    .............................................................................................................................................
    ...^.^.^.^.....^...^.^.....^.........^.^.^...^...^.^.^...^.^.^.^.^.^...^.......^.^.....^...^...^.^.^.^.^.^.^...^...^.^...^.^.^.^.........^...
    .............................................................................................................................................
    ..^.^.^...^.....^.....^.^...^.^.^.^.^.^.^.^.^...^...^...^.^.^.^...^.^.^...^.^.^.^.^...^...^.^.^.^...^...^.^.....^.^.....^...^...^.^.......^..
    .............................................................................................................................................
    .^.^.^.^.^.^...^.^.^...^...^.....^...^.^.^.....^.....^.^.^.^.......^.^...^.^...^.^.^.^...^.^...^.^...^.^.^.....^.^.^.^.^...^.^.......^.^.^.^.
    .............................................................................................................................................
    """
}
